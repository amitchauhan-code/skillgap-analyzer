{% extends "layout.html" %}
{% block title %}Skill Analysis - SkillGap{% endblock %}

{% block content %}
<div class="container py-5 min-vh-100">
    <h1 class="text-center display-4 mb-5 text-gradient fw-bold">
        Your Skill Analysis
    </h1>

    <!-- Overall Score Card -->
    <div class="text-center mb-5">
        {% with total = skills.values()|sum, count = skills.values()|length %}
            {% set avg = (total / count)|round(0) if count > 0 else 0 %}
            <div class="d-inline-block glass p-4 rounded-4 shadow-lg">
                <h3 class="mb-2">Overall Skill Level</h3>
                <h1 class="display-3 fw-bold text-primary">{{ avg }}%</h1>
                <p class="text-muted">
                    {% if avg >= 80 %}Excellent! You're crushing it!
                    {% elif avg >= 60 %}Good progress – keep going!
                    {% elif avg >= 40 %}Room for improvement – let's level up!
                    {% else %}Just getting started – you've got this!{% endif %}
                </p>
            </div>
        {% endwith %}
    </div>

    <div class="row g-5">
        <!-- Radar Chart -->
        <div class="col-lg-6">
            <div class="glass p-4 rounded-4 h-100 d-flex flex-column">
                <h3 class="text-center mb-4">Skill Radar</h3>
                <canvas id="skillsRadar"></canvas>
            </div>
        </div>

        <!-- Progress Bars -->
        <div class="col-lg-6">
            <div class="glass p-5 rounded-4">
                <h3 class="mb-4 text-center">Detailed Breakdown</h3>
                {% for skill, score in skills.items() %}
                <div class="mb-4 animate__animated animate__fadeInUp" style="animation-delay: {{ loop.index * 0.1 }}s">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong class="fs-5">{{ skill }}</strong>
                        <span class="badge 
                            {% if score >= 80 %}bg-success
                            {% elif score >= 60 %}bg-warning
                            {% else %}bg-danger{% endif %} fs-6 px-3 py-2">
                            {{ score }}%
                        </span>
                    </div>
                    <div class="progress rounded-pill" style="height: 28px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated
                            {% if score >= 80 %}bg-success
                            {% elif score >= 60 %}bg-warning text-dark
                            {% else %}bg-danger{% endif %}"
                            role="progressbar"
                            style="width: {{ score }}%"
                            aria-valuenow="{{ score }}"
                            aria-valuemin="0"
                            aria-valuemax="100">
                            <strong>{{ score }}%</strong>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <div class="text-center mt-5">
                    <a href="{{ url_for('courses') }}" 
                       class="btn btn-lg btn-primary px-5 py-3 shadow-lg hover-lift">
                        Get Personalized Courses
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js + Animation -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('skillsRadar').getContext('2d');
        
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: [{% for skill in skills.keys() %}'{{ skill }}', {% endfor %}],
                datasets: [{
                    label: 'Your Current Level',
                    data: [{% for score in skills.values() %}{{ score }}, {% endfor %}],
                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                    borderColor: '#818cf8',
                    pointBackgroundColor: '#6366f1',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#6366f1',
                    borderWidth: 3,
                    tension: 0.3
                }]
            },
            options: {
                plugins: {
                    legend: { labels: { color: '#e0e7ff', font: { size: 14 } } }
                },
                scales: {
                    r: {
                        angleLines: { color: '#6366f1' },
                        grid: { color: 'rgba(99, 102, 241, 0.3)' },
                        pointLabels: { color: '#c4b5fd', font: { size: 15, weight: 'bold' } },
                        ticks: {
                            beginAtZero: true,
                            max: 100,
                            stepSize: 20,
                            color: '#a78bfa',
                            backdropColor: 'transparent'
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    }
                }
            }
        });
    });
</script>

<style>
    .text-gradient {
        background: linear-gradient(90deg, #818cf8, #c084fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(99,102,241,0.4) !important;
    }
</style>
{% endblock %}